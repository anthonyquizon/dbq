
# picosat?
FFIâ†{"../extern/libpicosat.so" â€¢FFI ğ•©}

noneâ€¿satâ€¿unsatâ†0â€¿10â€¿20

c_init     â† FFI "*"â€¿"picosat_init"
c_reset    â† FFI ""â€¿"picosat_reset"â€¿"*"
c_set_seed â† FFI ""â€¿"picosat_set_seed"â€¿"*"â€¿"i32"
c_print    â† FFI ""â€¿"picosat_print"â€¿"*"â€¿"*u32"
c_sat      â† FFI "i32"â€¿"picosat_sat"â€¿"*"â€¿"u32"
c_add      â† FFI "i32"â€¿"picosat_add"â€¿"*"â€¿"i32"
c_deref    â† FFI "i32"â€¿"picosat_deref"â€¿"*"â€¿"i32"

Initâ†{ğ•Š:
  pâ†C_init âŸ¨âŸ©

  Genâ‡{
    qâ†â·âˆ¾|ğ•©
    C_addÂ¨pâŠ¸âˆ¾âŒœâˆ¾âˆ¾âŸœ0Â¨ğ•©  
    C_sat pâ€¿100
    â‰qâˆ¾Ë˜C_derefÂ¨pâŠ¸âˆ¾âŒœq # return literals under variable index
  }

  # TODO add deref to new clause and regen

  Endâ‡{ğ•Š: C_resetâ‹ˆp }
}

#â€¢Show "--"
#pâ†Init@
#â€¢Show p.Gen âŸ¨ 1â€¿Â¯2, 1â€¿2, 9â€¿2, 7â€¿3 âŸ©
#p.End@


â€¢Show 1=100
#â€¢Show âˆ¨Â´(1=â€¢Type)Â¨"woo"

# encode âˆƒâˆ€x<â‰ x | xáµ¢<x
#! âŸ¨râ‚...âŸ©
#! âŸ¨x,nâŸ©|(xáµ¢=xâ±¼,iâ‰ j) () â†’ 
#Fooâ†{
  #ğ•©: ğ•©âŠğ•©
#}



#C_add pâ€¿1
#C_add pâ€¿Â¯2
#C_add pâ€¿0
#C_add pâ€¿1
#C_add pâ€¿2
#C_add pâ€¿0
#â€¢Show C_sat pâ€¿100

#â€¢SHow aâ† C_deref pâ€¿2

#C_add pâ€¿(a)
#C_add pâ€¿0
#C_sat pâ€¿100
#â€¢SHow C_deref pâ€¿2

##C_set_seed âŸ¨p, 100âŸ©

Câ†{
  ğ•Š  ğ•©: 2=â€¢Typeğ•©
; ğ•Šâ¼ âŸ¨fooâ‡fooâŸ©: foo
; ğ•Šâ¼ ğ•©: 111
}


râ†â€¢MakeRand 10

â€¢Show 2=â€¢TypeÂ¨âŸ¨1,'c',3âŸ©
â€¢Show âˆ¨Â´2=â€¢TypeÂ¨âŸ¨1,'c',3âŸ©

â€¢Show Câ¼ {fooâ‡2}
â€¢Show Câ¼ 111
â€¢Show '0'+100 r.Range 100
#grâ†2 â‹„ glâ†1.5â‹„ srâ†1â‹„ slâ†0.9                     # sl: length shrink factor, gr: range factor, rs: shrink range factor, gl: length factor

# G: generator function
# F: function to test
# m: message
#_Gen_â†{ G _ğ•£_ F m:
  #pâ†@
  #jâ†10â‹„vâ†@â‹„rsâ†1â‹„iâ†0 â‹„ tâ†â‰>âŸ¨0âˆ¾grâ‹†â†•10, 0âˆ¾âŒŠglâ‹†â†•10âŸ© # rs: result

  #{ğ•Š:                                           # grow
    #xâ€¿yâ†iâŠt â‹„ iâ†©i+1 â‹„ lâ€¿hâ†xÃ—Â¯1â€¿1 â‹„ pâ†©v
    #(i<â‰ t)âˆ§rsâ†©G F vâ†©l+y r.Range 1+h-l
  #} â€¢_while_ (0âŠ¸â‰¢) @

  #{ğ•Š:                                           # shrink
    #v {ğ•©â†‘ËœâŒŠslÃ—â‰ ğ•©}âŸ(0.5<(r.Range 0)â‹†1.2) â†©       # shrink length
    #v {(âŠ£-srâŠ¸Ã—âˆ˜Ã—)âŒ¾((âŠ‘â’|ğ•©)âŠ¸âŠ) ğ•©}âŸ(0âŠ¸â‰ â‰ ) â†©        # shrink lagrest delta from 0
    #(j-âŸœ1â†©)âˆ§(1â‰¡(GâŸœF)âŸ(â‰¢âŸœp) v)
  #} â€¢_while_ {(0â‰¢ğ•©)âˆ§Â¬rs} @

  #âŠ¢â—¶âŸ¨
    #{ğ•Š: â€¢OutÂ¨mâ€¿"Counter example:"â€¿(â€¢Fmt F p) }
    #{ğ•Š: â€¢Out mâˆ¾": Ok" }
  #âŸ© rs
#}

# get domain with random distribution
# propagator Dâ†’âŠ†D
# a=b -> a-bâ†’c, 0â€¿1â€¿1

_Genâ†{ F _ğ•£ ğ•©:
  pâ†vâ†r.Deal Ã—Â´ğ•©
  â€¢SHow "--"
  â€¢Show bâ†30 r.Range 2
  #â€¢Show câ†7â‰¥30 r.Range 10
  #â€¢Show dâ†6â‰¥30 r.Range 10
  #â€¢Show eâ†8â‰¥30 r.Range 10
  #â€¢SHow bÃ—c
  #â€¢SHow bÃ—cÃ—d
  #â€¢SHow tâ†e/bÃ—cÃ—d
  #mâ†(10 r.Deal Ã—Â´ğ•©)Ã—(r.Deal<r.Deal) Ã—Â´ğ•©
  #â€¢SHow m
  #â€¢Show ğ•©â¥Šv
  #â€¢Show ğ•©â¥Šv+m

  #{ğ•Š:
    #âŠ
  #} â€¢_While_ âŠ£ 1
}


Fmtâ†{cğ•Šq:                                       # format string to replace âŒ¾X values 
  kâ†Â»zâ†c='âŒ¾' â‹„ câ€¿k (Â¬z)âŠ¸/ËœÂ¨â†©                    # with empty strings as default value
  âˆ¾(q((âŸ¨""âŸ©âˆ¾Ëœ1âŠ¸âŠ)âˆ˜âŠ£âŠËœâŠâŠ¸âŠ)k/c)âŒ¾(kâŠ¸/) c
}

#~ ğ•©:âŸ¨4,3âŸ© â†’ âŸ¨4,3âŸ© | ğ•©>0
#Fâ†{ ğ•©+1 }

#F _Gen 4â€¿3



#propâ‡{
  #râ†â€¢MakeRand 10
  #grâ†2 â‹„ glâ†1.5â‹„ srâ†1â‹„ slâ†0.9 # sl: length shrink factor, gr: range factor, rs: shrink range factor, gl: length factor

#}

#câ†"
##~ {aâ‡,bâ‡} â†’ âŸ¨2,nâŸ© | a:âŸ¨1,4âŸ© b:âŸ¨4,nâŸ©
#Fooâ†{ ğ•© }
#"

#dâ†"
##~ {a:âŸ¨1,4âŸ©, b:[2,4,n]} ğ•Š âŸ¨aâ‚,aâ‚‚âŸ© â†’ âŸ¨aâ‚,nâŸ© 
#Fooâ†{ ğ•©+2 }
#"

#eâ†"
## same shape
##~ âŸ¨2,3âŸ© â†’ âŸ¨2,3,4âŸ©
##~ âŸ¨2,3âŸ© â†’ âŸ¨xâ‚...xâ‚™âŸ© 
#Fooâ†{ ğ•©+2 }
#"

#câ†â€¢FChars âŠ‘â€¢args
#â€¢Show â€¢Import âŠ‘â€¢args

# compile specs
# generate tests?
# generate and shrink inputs


