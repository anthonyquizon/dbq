
tâ†"ğ•¨ğ•©"
uâ†"wx"

eâ†@+27
effâ†@
histâ†âŸ¨âŸ©
châ†âŸ¨âŸ©
psâ†0 # cursor position
hiâ†0 # history position

# ctrl-enter - continue
# ctrl-. - next

clearâ†eâˆ¾"[2K"âˆ¾eâˆ¾"[0G"

Nopâ†{ğ•Š:@}
Cmdâ†{ğ•Š:
  # TODO add to history
  â€¢term.OutRaw clear
  â€¢Show "command" 
}

Mapâ†{
  #ğ•¨ğ•Šğ•©: âŠ‘"\"=Â¯1â†‘ğ•¨ ? âŸ¨(Â¯1â†“ğ•¨)âˆ¾zâ†t/Ëœğ•©=u, (â‰ z)+ps-1, nopâŸ© # TODO insert in current position
  ğ•©:ğ•©â‰¡eâˆ¾"[D"? âŸ¨ch,     0âŒˆps-1,     NopâŸ©
; ğ•©:ğ•©â‰¡eâˆ¾"[C"? âŸ¨ch,     (â‰ ch)âŒŠps+1, NopâŸ©
; ğ•©:ğ•©â‰¡â‰@+10 ? âŸ¨âŸ¨âŸ©,     0,          CmdâŸ© 
; ğ•©:ğ•©â‰¡â‰@+127? âŸ¨Â¯1â†“ch,  ps-1,       NopâŸ© # TODO delete current position first
; ğ•©:ğ•©â‰¡â‰@+21 ? âŸ¨âŸ¨âŸ©,     0,          NopâŸ©
; ğ•©:0=â‰ ch   ? âŸ¨ğ•©,      1,          NopâŸ©
; ğ•©:          âŸ¨âˆ¾(âˆ¾âŸœğ•©)Â¨âŒ¾(1âŠ¸â†‘)châŠ”Ëœpsâ‰¤â†•â‰ ch, ps+1, NopâŸ© # TODO fix ğ•© is list of chars, insert character in position ps
}

# Consume chars until letter (ANSI format for keypresses)
# if e [ -> consume until letter
Inputâ†{
   ğ•Š@:                    ğ•Šâ€¢term.CharB@
;  ğ•Šğ•©:ğ•©=e             ?ğ•©âˆ¾eğ•Šâ€¢term.CharB@
;  ğ•Šğ•©:                âŸ¨ğ•©âŸ©
; eğ•Šğ•©:âŠ‘ğ•©âˆŠâˆ¾+âŸœ(â†•26)Â¨"Aa"?ğ•©
; eğ•Šğ•©:                 ğ•©âˆ¾eğ•Šâ€¢term.CharB@
}

â€¢term.RawMode 1
{ğ•Š:
  châ€¿psâ€¿Effâ†©Map Input@
  Eff @

  â€¢term.OutRaw clear # clear line and set to start of line
  â€¢term.OutRaw â€¢ToUTF8 ch
  â€¢term.OutRaw eâˆ¾"["âˆ¾(â€¢Fmt ps+1)âˆ¾"G"
  â€¢term.Flush@
}â€¢_while_ 1 @

