
t←"𝕨𝕩"
u←"wx"

e←@+27

ch←⟨⟩
ps←0

nop‿mov‿cmd‿clr←↕4 # effect flags

# TODO up and down for history

clear←e∾"[2K"∾e∾"[0G"
Map←{
  𝕨𝕊𝕩: ⊑"\"=¯1↑𝕨 ? ⟨(¯1↓𝕨)∾t/˜𝕩=u, ps,   nop⟩
; 𝕨𝕊𝕩: 𝕩=@+10    ? ⟨⟨⟩,            0,    cmd⟩ 
; 𝕨𝕊𝕩: 𝕩=@+127   ? ⟨¯1↓𝕨,          ps-1, nop⟩ # TODO delete current position first
; 𝕨𝕊𝕩: 𝕩=@+21    ? ⟨⟨⟩,            0,    clr⟩
; 𝕨𝕊𝕩: 𝕩=e       ? ⟨𝕨,             ps,   mov⟩
; 𝕨𝕊𝕩: 0=≠𝕨      ? ⟨𝕨∾𝕩,           1,    nop⟩
; 𝕨𝕊𝕩:             
    ⟨∾(∾⟜𝕩)¨⌾(1⊸↑) 𝕨⊔˜ps≤↕≠𝕨, ps+1, nop⟩ # insert character in position ps
}

•term.RawMode 1
{𝕊:
  ⟨ch0,ps0,eff⟩←ch  Map •term.CharB@
  prv←ch⋄ps↩ps0⋄ch↩ch0
  { 𝕊𝕩:𝕩=mov ? {"[D":ps↩ps-1;"[C": ps↩ps+1;·:@}⟨•term.CharB@,•term.CharB@⟩ 
  ; 𝕊𝕩:𝕩=cmd ?  •term.OutRaw clear ⋄ •Show "command: " ∾ prv
  ; 𝕊𝕩:@
  } eff

  •term.OutRaw clear # clear line and set to start of line
  •term.OutRaw •ToUTF8 ch
  •term.OutRaw e∾"["∾(•Fmt ps+1)∾"G"
  •term.Flush@
}•_while_ 1 @

